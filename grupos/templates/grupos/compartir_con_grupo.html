{% extends 'base.html' %}
{% load staticfiles %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'assets/plugins/ui_autocomplete/jquery-ui.min.css' %} ">
{% endblock extra_css %}

{% block content %}
<div class = "col-md-6 col-md-offset-1">
	<br>
	<form class="form-horizontal" method="post" action="{% url 'grupos:compartir_libro_grupo' grupo.id %}">
		<fieldset>
			{% csrf_token %}
			<!-- Form Name -->
			<legend>Compartir un libro con <a target="_blank" href="{% url 'grupos:main_grupo_actividad' grupo.id %}">{{grupo.nombre}}</a></legend>

			<!-- Multiple Radios -->
			<div class="form-group">			  
			  <div class="col-md-10 col-md-offset-1">
			  	<div class="radio">
				    <label for="radios-0">
				      <input id="c_existente" name="tipo_libro" value="existente" checked="checked" type="radio">
				      Compartir un libro <strong> existente </strong> en Mi Biblioteca.
				    </label>
				</div>
				<div class="radio">
				   <label for="radios-1">
				      <input id="c_nuevo" name="tipo_libro" value="nuevo" type="radio">
				      Compartir un <strong> nuevo </strong> libro.
				   </label>
				</div>
			  </div>
			</div>

			<div class="divider"> <!-- divider -->
				<i class="fa fa-book"></i>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <div class="col-md-12">
				  <input id="titulo" name="titulo_id" placeholder="Título" class="form-control input-md" type="text">
				  <span id="help_titulo" class="help-block">El título de un libro de tu Biblioteca.</span>
			  </div>
			</div>

			<!-- Text input-->
			<div class="form-group">
			  <div class="col-md-12">
				  <input id="autor" name="autor" placeholder="Autor" class="form-control input-md" type="text">
				  <span class="help-block">El nombre del autor del Libro.</span>
			  </div>
			</div>

			<!-- Textarea -->
			<div id="input_descripcion" class="form-group hidden">
			  <div class="col-md-12">
			    <textarea class="form-control" name="descripcion" placeholder="Edición, traductor, un link a Amazon que muestre la versión del libro que tienes, el estado del libro o cualquier información extra que desees compartir."></textarea>
			    <span class="help-block">Opcional: una corta descripción.</span>
			  </div>
			</div>

			<input class = "btn btn-success pull-right" type="submit" value="Compartir">
		</fieldset>
	</form>

	<hr class = "invisible">
</div>

<div class ="col-md-4">
	<hr class="invisible half-margins">
	<p class ="well">
	<i class = "fa fa-info-circle"></i>		
		El usuario al que le prestes este libro en el futuro podrá contactarte de las siguientes maneras:
		<br>
		<br>

		{% if user.email %}
			Tu correo electrónico: {{user.email}}
		{% else %}
			No tienes un correo electrónico registrado
		{% endif %}

		<br>

		{% if perfil_usuario.numero_telefono_contacto %}
			Tu número de teléfono: {{perfil_usuario.numero_telefono_contacto}}
		{% else %}
			<br>No tienes un número de contacto registrado. Por favor <a href="{% url 'perfiles:editar_perfil' %}">edita tu perfil</a> y añade un número de teléfono de contacto.
		{% endif %}

		<br><br>
		Las formas de contactarte que especifiques en tu mensaje de aceptación cuando le prestes el libro.
		<br><br>

		<i class ="fa fa-user-secret"></i> No usamos tus números de teléfono ni tu email para ningún otro fin.
	</p>
</div>

{% endblock content %}

{% block extra_javascript %}
<script type="text/javascript" src="{% static 'assets/js/jquery-ui-fold.js' %}"></script>
<script type="text/javascript" src="{% static 'assets/plugins/ui_autocomplete/jquery-ui.min.js' %}"></script>

<script>
$(document).ready(function(){

	// esconder / aparecer descripcion
	$("#input_descripcion").hide();
	$("#input_descripcion").removeClass("hidden");
	$("#c_nuevo").on("change", function(){
		if ($(this).is(":checked")){
			$("#input_descripcion").show("fold");
			$("#help_titulo").text("El título del libro, se añadirá a tu Biblioteca.");
		}
	});

	$("#c_existente").on("change", function(){
		if ($(this).is(":checked")){
			$("#input_descripcion").hide("fold");
			$("#help_titulo").text("El título de un libro de tu Biblioteca")
		}
	});

	// autocomplete titulos / autores
	var titulos_autocomplete = []
	var titulos_list = JSON.parse('{{titulos_autocomplete|safe}}');	
	$.each(titulos_list, function(index, value){
		console.log(value);
		titulos_autocomplete.push({'label': value[0], 'value': value[1]});
	});

	$("#titulo").autocomplete({
		source: titulos_autocomplete,
		minLength: 2
	});

	var autores_autocomplete = []
	var autores_list = JSON.parse('{{autores_autocomplete|safe}}');
	$.each(autores_list, function(index, value){
		autores_autocomplete.push({'label': value[1], 'value': value[0]});
	});

	$("#autor").autocomplete({
		source: autores_autocomplete,
		minLength: 2
	});
});
</script>
{% endblock extra_javascript %}
